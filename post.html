<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bootstrap demo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"
    integrity="sha512-uMtXmF28A2Ab/JJO2t/vYhlaa/3ahUOgj1Zf27M5rOo8/+fcTUVH0/E0ll68njmjrLqOBjXM3V9NiPFL5ywWPQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
    crossorigin="anonymous"></script>

  <style>
    .center {
      margin: 30px 0;
    }


    #post-created {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 80px;
      height: 80px;
      background-color: rgb(13, 131, 209);
      position: fixed;
      bottom: 10%;
      right: 5%;
      border-radius: 50%;
      cursor: pointer;
    }

    #liveAlertPlaceholder {
      z-index: 999;
    }
  </style>
</head>

<body>
  <div class="container">
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <a class="navbar-brand" href="home.html">themse</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="home.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="profile.html">Profile</a>
            </li>

          </ul>

          <div id="login/regester" class="d-flex"
            style="justify-content: space-between; width: 170px;align-items: center;">
            <b id="userLogo"></b>
            <img id="imageLogo" style="width: 50px;height: 50px; border-radius: 50%;margin: 0 10px;" src="" alt="">
            <button onclick="logautt(),getpost()" id="logaut" class="btn btn-outline-danger"
              type="button">logaut</button>
            <button id="login" class="btn btn-outline-success" type="button" data-bs-toggle="modal"
              data-bs-target="#loginModal">login</button>
            <button data-bs-toggle="modal" data-bs-target="#regsterModal" id="regester" class="btn btn-outline-success"
              type="submit">regester</button>
          </div>
        </div>
      </div>
    </nav>
  </div>
  <div class="container">
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-2" id="exampleModalLabel">Login</h1>
          </div>
          <div class="modal-body">
            <h3>Email</h3>
            <input id="email" placeholder="Enter your email" type="email">
            <h3>Password</h3>
            <input id="password" placeholder="Enter your password" type="password">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button onclick="getInputValues()" type="button" data-bs-dismiss="modal" class="btn btn-primary">Login
              Now</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="regsterModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-2" id="exampleModalLabel">regester</h1>
          </div>
          <div class="modal-body">
            <h3>Email</h3>
            <input id="email-reg" placeholder="Enter your email" type="email">
            <h3>username</h3>
            <input id="username-reg" placeholder="Enter your username" type="text">
            <h3>Password</h3>
            <input id="password-reg" placeholder="Enter your password" type="password">
            <h3>name</h3>
            <input id="name-reg" placeholder="Enter your name" type="text">
            <h3>image</h3>
            <input id="image-reg" placeholder="Enter your email" type="file">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button onclick="regesterrr()" type="button" data-bs-dismiss="modal" class="btn btn-primary">regester
              Now</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="show fade" style="width: 30%;position: fixed;bottom: 0;right: 0;" id="liveAlertPlaceholder"></div>


  <div id="content-card" style="width: 70%;margin: auto;">

  </div>

  <div class="modal fade" id="post-created-model" tabindex="-1" aria-labelledby="exampleModalLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-2" id="headTitel">Crated Post</h1>
          </div>
          <div class="modal-body">
            <h3>title</h3>
            <input id="titlePost" type="text">
            <h3>body</h3>
            <textarea id="bodyPOST" style="width: 100%; height: 100px;resize: none;"></textarea>
            <h3>image</h3>
            <input id="image" placeholder="Enter your email" type="file">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button onclick="cratedPosted()" type="button" data-bs-dismiss="modal" class="btn btn-primary">crate
              Post</button>
            <input type="hidden" id="fals">
          </div>
        </div>
      </div>
    </div>


</body>
<script src="mainLogic.js"></script>


<script>
  let allCommentsHTML = '';

  url = new URLSearchParams(window.location.search)
  id = url.get('postId')


  comntContent = ''

  getpost()





  function getpost() {
    contentCard = document.getElementById('content-card')
    var requestOptions = {
      method: 'GET',
      redirect: 'follow'
    };

    fetch(`https://tarmeezacademy.com/api/v1/posts/${id}`, requestOptions)
      .then(response => response.json())
      .then(response => {
        post = response.data;
        comments = response.data.comments;
        comnt = ''
        btns = ''
        comntContent = ''


        if (localStorage.getItem('user') != null) {
          user = JSON.parse(localStorage.user)
          if (post.author.id === user.id) {
            btns = `
            <button type="button" data-bs-toggle="modal" data-bs-target="#post-created-model" onclick="editPost('${encodeURIComponent(JSON.stringify(post))}')">Edit</button>
            <button onclick="deletePost()" id="delete">Delete</button>
                   `
            comntContent = `
                 <h1>comnts</h1>
                     <input type="text" placeholder="write your commnt" id="inputComnt">
                     <button onclick="createComnts()" id="btnComnt">crate Comnts</button>
                 `
          } else {
            comntContent = `
        <h1>comnts</h1>
            <input type="text" placeholder="write your commnt" id="inputComnt">
            <button onclick="createComnts()" id="btnComnt">crate Comnts</button>
        `

          }

        }

        for (comment of comments) {
          comnt += `
        <div style="padding: 7px; border-radius: 15px 15px 0 0;background-color: rgb(185, 185, 185); display: flex; align-items: center;">
          <img style=" margin-right: 10px; height: 40px; width: 40px; border-radius: 50%;" id="img-comnts"
            src="${comment.author.profile_image}">
          <span id="user-comnts">${comment.author.name}</span>

        </div>
        <p style="border-radius: 0 0 15px 15px;background-color: rgb(208, 225, 235);" id="bodyComnts">${comment.body}</p>
        `;

        }
        let contnt1 = `
      <div class="card center">
        <div class="d-flex card-body" style="display: flex; justify-content: space-between; align-items: center;">
          <div style="display: flex; align-items: center;">
            <img src="${post.author.profile_image}" style="width: 50px; height: 50px; border-radius: 50%;" alt="">
            <h5 class="card-header" style="margin-left: 10px;">@${post.author.name}</h5>
          </div>
          <div id='id-btn'>
            ${btns}
          </div>
        </div>
        <div style="cursor: pointer;" class="card-body">
          <img src="${post.image}" alt="" style="width: 100%;">
          <span><small class="text-body-secondary">${post.created_at}</small></span>
          <p class="card-text">${post.body}</p>
          <hr>
          <p> (${post.comments_count}) comments </p>
        </div>
        <div id="comntss">
          ${comnt}
        </div>
        <div id="crateComnt">
             ${comntContent}  
        </div>
      `;

        contentCard.innerHTML = contnt1; // استخدم "=" بدلاً من "+="
      });
  }


  function createComnts() {
    var token = localStorage.getItem('token');
    var inputComnt = document.getElementById('inputComnt').value;

    var prams = {
      "body": inputComnt
    };

    var headers = {
      "Authorization": `Bearer ${token}`
    };

    var requestOptions = {
      headers: headers,
      data: prams
    };

    axios.post(`https://tarmeezacademy.com/api/v1/posts/${id}/comments`, prams, requestOptions) // استبدل null بـ prams هنا
      .then(result => {
        console.log(result);
        getpost();
      })
      .catch(error => console.log('error', error));
  }

</script>

</html>